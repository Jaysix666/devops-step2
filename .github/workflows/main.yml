deploy:
  name: Deploy
  needs: build
  runs-on: self-hosted

  steps:
    # Docker Hub 로그인
    - name: Docker login
      uses: docker/login-action@v2
      with:
        username: ${{ env.DOCKER_USERNAME }}
        password: ${{ secrets.DOCKER_PASSWORD }}

    # Docker 이미지 pull
    - name: Docker image pull
      run: docker pull ${{ env.DOCKER_USERNAME }}/devops_step2:v1.0

    # 기존 컨테이너 정리
    - name: Stop & Remove container
      run: |
        docker stop devops_step2 || true
        docker rm devops_step2 || true

    # docker compose 실행 (경로 + 명령어 한 step에서)
    - name: Docker compose up
      run: |
        cd /home/kosa/devops-step2
        docker compose -f docker-compose_nginx.yml up -d
